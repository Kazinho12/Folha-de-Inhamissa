<!DOCTYPE html>
<html lang="pt-MZ">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aprenda | Folha de Inhamissa</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
    --primary: #FFD700;
    --primary-dark: #FFC107;
    --primary-light: #FFE55C;
    --accent: #FFD700;
    --accent-dark: #FFC107;
    --text: #FFFFFF;
    --text-light: #b0b0b0;
    --text-lighter: #808080;
    --light: #1a1a1a;
    --lighter: #0a0a0a;
    --white: #000000;
    --gray: #333333;
    --dark-gray: #d0d0d0;
    --error: #e74c3c;
    --error-light: #fadbd8;
    --success: #2ecc71;
    --success-light: #d5f5e3;
    --warning: #f39c12;
    --info: #3498db;

    /* Cores das mat√©rias */
    --math-color: #e74c3c;
    --math-light: #fadbd8;
    --portuguese-color: #3498db;
    --portuguese-light: #d6eaf8;
    --history-color: #2ecc71;
    --history-light: #d5f5e3;
    --school-history-color: #9b59b6;
    --school-history-light: #e8daef;
    --geography-color: #f39c12;
    --geography-light: #fdebd0;
    --biology-color: #27ae60;
    --biology-light: #d4efdf;
    --physics-color: #8e44ad;
    --physics-light: #e8daef;
    --chemistry-color: #16a085;
    --chemistry-light: #d1f2eb;
    --civics-color: #c0392b;
    --civics-light: #fadbd8;
    --english-color: #2980b9;
    --english-light: #d6eaf8;

    --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --card-shadow-hover: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --modal-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);

    --border-radius-sm: 6px;
    --border-radius-md: 12px;
    --border-radius-lg: 16px;

    --transition: all 0.3s ease;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
}

body {
    background-color: #000000;
    color: var(--text);
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    line-height: 1.6;
    transition: background-color 0.3s, color 0.3s;
}

/* Typography */
h1, h2, h3, h4, h5, h6 {
    font-weight: 600;
    line-height: 1.3;
    margin-bottom: 0.75rem;
}

h1 { font-size: 2rem; }
h2 { font-size: 1.75rem; }
h3 { font-size: 1.5rem; }
h4 { font-size: 1.25rem; }
h5 { font-size: 1.1rem; }
h6 { font-size: 1rem; }

p {
    margin-bottom: 1rem;
}

a {
    color: var(--primary);
    text-decoration: none;
    transition: var(--transition);
}

a:hover {
    color: var(--primary-dark);
    text-decoration: underline;
}

/* App Bar */
.app-bar {
    position: fixed;
    top: 0;
    width: 100%;
    background-color: var(--white);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    padding: 12px 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 1000;
}

.logo {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 700;
    color: var(--primary);
    text-decoration: none;
    font-size: 1.2rem;
}

.logo-icon {
    font-size: 1.5rem;
}

.app-bar-title {
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--text);
}

.app-bar-actions {
    display: flex;
    align-items: center;
    gap: 10px;
}

.search-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: var(--transition);
    background-color: var(--light);
    color: var(--text-light);
    border: none;
}

.search-btn:hover {
    background-color: var(--gray);
    color: var(--text);
}

/* Search Modal */
.search-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    z-index: 1001;
    padding-top: 80px;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.search-container {
    background-color: var(--white);
    max-width: 600px;
    margin: 0 auto;
    border-radius: var(--border-radius-md);
    overflow: hidden;
    box-shadow: var(--modal-shadow);
    transform: translateY(0);
    transition: transform 0.3s ease;
}

.search-modal.active .search-container {
    transform: translateY(0);
}

.search-header {
    padding: 16px;
    display: flex;
    align-items: center;
    gap: 10px;
    border-bottom: 1px solid var(--gray);
    background-color: var(--primary);
    color: white;
}

.search-input {
    flex: 1;
    padding: 10px 15px;
    border: 1px solid var(--gray);
    border-radius: 20px;
    font-size: 1rem;
    outline: none;
    transition: var(--transition);
}

.search-input:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px var(--primary-light);
}

.close-search {
    font-size: 1.5rem;
    color: white;
    cursor: pointer;
    transition: var(--transition);
}

.close-search:hover {
    transform: scale(1.1);
}

.search-results {
    max-height: 70vh;
    overflow-y: auto;
    padding: 16px;
}

.search-result-item {
    padding: 12px;
    border-bottom: 1px solid var(--gray);
    cursor: pointer;
    transition: var(--transition);
    border-radius: var(--border-radius-sm);
}

.search-result-item:hover {
    background-color: var(--light);
}

.search-result-item:last-child {
    border-bottom: none;
}

/* Main Content */
.main-content {
    flex: 1;
    padding: 80px 16px 100px;
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
}

.page-header {
    margin-bottom: 24px;
    text-align: center;
}

.page-title {
    font-size: 1.8rem;
    color: var(--primary-dark);
    margin-bottom: 8px;
}

.page-subtitle {
    color: var(--text-light);
    font-size: 1rem;
    max-width: 700px;
    margin: 0 auto;
}

/* Learning Modules */
.learning-modules {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 30px;
}

.module-card {
    background: var(--white);
    border-radius: 20px;
    overflow: hidden;
    box-shadow: var(--card-shadow);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    display: flex;
    flex-direction: column;
    height: 100%;
    border: 1px solid rgba(255, 215, 0, 0.1);
    position: relative;
    animation: fadeInUp 0.5s ease-out;
}

.module-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--primary), var(--primary-dark));
    transform: scaleX(0);
    transition: transform 0.3s ease;
}

.module-card:hover::before {
    transform: scaleX(1);
}

.module-card:hover {
    transform: translateY(-10px) scale(1.02);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    border-color: rgba(255, 215, 0, 0.3);
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.module-image {
    height: 160px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 3rem;
    position: relative;
    overflow: hidden;
}

.module-image::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(to bottom, rgba(0,0,0,0.1), rgba(0,0,0,0.3));
}

.module-icon {
    z-index: 1;
}

.module-content {
    padding: 16px;
    flex: 1;
    display: flex;
    flex-direction: column;
}

.module-title {
    font-size: 1.2rem;
    margin-bottom: 8px;
    font-weight: 600;
}

.module-description {
    color: var(--text-light);
    font-size: 0.9rem;
    margin-bottom: 12px;
    flex: 1;
}

.module-progress {
    height: 6px;
    background-color: var(--gray);
    border-radius: 3px;
    margin-bottom: 12px;
    overflow: hidden;
}

.progress-bar {
    height: 100%;
    width: 0%;
    transition: width 0.5s ease;
    position: relative;
}

.progress-bar::after {
    content: attr(data-progress);
    position: absolute;
    right: 5px;
    top: 50%;
    transform: translateY(-50%);
    color: white;
    font-size: 0.6rem;
    font-weight: bold;
}

.module-meta {
    display: flex;
    justify-content: space-between;
    font-size: 0.8rem;
    color: var(--text-light);
}

/* Module Colors */
.math-module .module-image {
    background-color: var(--math-color);
}
.math-module .module-title {
    color: var(--math-color);
}
.math-module .progress-bar {
    background-color: var(--math-color);
}

.portuguese-module .module-image {
    background-color: var(--portuguese-color);
}
.portuguese-module .module-title {
    color: var(--portuguese-color);
}
.portuguese-module .progress-bar {
    background-color: var(--portuguese-color);
}

.history-module .module-image {
    background-color: var(--history-color);
}
.history-module .module-title {
    color: var(--history-color);
}
.history-module .progress-bar {
    background-color: var(--history-color);
}

.school-history-module .module-image {
    background-color: var(--school-history-color);
}
.school-history-module .module-title {
    color: var(--school-history-color);
}
.school-history-module .progress-bar {
    background-color: var(--school-history-color);
}

.geography-module .module-image {
    background-color: var(--geography-color);
}
.geography-module .module-title {
    color: var(--geography-color);
}
.geography-module .progress-bar {
    background-color: var(--geography-color);
}

.biology-module .module-image {
    background-color: var(--biology-color);
}
.biology-module .module-title {
    color: var(--biology-color);
}
.biology-module .progress-bar {
    background-color: var(--biology-color);
}

.physics-module .module-image {
    background-color: var(--physics-color);
}
.physics-module .module-title {
    color: var(--physics-color);
}
.physics-module .progress-bar {
    background-color: var(--physics-color);
}

.chemistry-module .module-image {
    background-color: var(--chemistry-color);
}
.chemistry-module .module-title {
    color: var(--chemistry-color);
}
.chemistry-module .progress-bar {
    background-color: var(--chemistry-color);
}

.civics-module .module-image {
    background-color: var(--civics-color);
}
.civics-module .module-title {
    color: var(--civics-color);
}
.civics-module .progress-bar {
    background-color: var(--civics-color);
}

.english-module .module-image {
    background-color: var(--english-color);
}
.english-module .module-title {
    color: var(--english-color);
}
.english-module .progress-bar {
    background-color: var(--english-color);
}

/* Learning Modal */
.learning-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    z-index: 1001;
    overflow-y: auto;
    padding: 20px 0;
    animation: fadeIn 0.3s ease;
}

.learning-container {
    background-color: var(--white);
    max-width: 800px;
    margin: 0 auto;
    border-radius: var(--border-radius-md);
    overflow: hidden;
    box-shadow: var(--modal-shadow);
    transform: translateY(0);
    transition: transform 0.3s ease;
}

.learning-header {
    padding: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid rgba(255,255,255,0.2);
    color: white;
    position: sticky;
    top: 0;
    z-index: 10;
}

.learning-title {
    font-size: 1.3rem;
    font-weight: 600;
}

.close-learning {
    font-size: 1.5rem;
    color: white;
    cursor: pointer;
    transition: var(--transition);
    background: none;
    border: none;
}

.close-learning:hover {
    transform: scale(1.1);
}

.learning-body {
    padding: 20px;
    max-height: calc(100vh - 120px);
    overflow-y: auto;
}

.learning-content {
    margin-bottom: 20px;
}

.learning-section {
    margin-bottom: 30px;
}

.section-title {
    font-size: 1.2rem;
    margin-bottom: 15px;
    padding-bottom: 8px;
    border-bottom: 2px solid var(--gray);
    display: flex;
    align-items: center;
    gap: 10px;
}

.section-title::before {
    content: '';
    display: inline-block;
    width: 8px;
    height: 20px;
    border-radius: 4px;
}

.section-content {
    line-height: 1.7;
}

.section-content p {
    margin-bottom: 15px;
}

.section-content ul, .section-content ol {
    margin-bottom: 15px;
    padding-left: 20px;
}

.section-content li {
    margin-bottom: 8px;
}

.section-image {
    max-width: 100%;
    height: auto;
    border-radius: var(--border-radius-sm);
    margin: 15px 0;
    display: block;
    box-shadow: var(--card-shadow);
}

.vocabulary-table, .grammar-table {
    width: 100%;
    border-collapse: collapse;
    margin: 15px 0;
    box-shadow: var(--card-shadow);
    border-radius: var(--border-radius-sm);
    overflow: hidden;
}

.vocabulary-table th, .grammar-table th {
    background-color: var(--primary);
    color: white;
    padding: 10px;
    text-align: left;
}

.vocabulary-table td, .grammar-table td {
    padding: 10px;
    border-bottom: 1px solid var(--gray);
}

.vocabulary-table tr:last-child td, .grammar-table tr:last-child td {
    border-bottom: none;
}

.vocabulary-table tr:nth-child(even), .grammar-table tr:nth-child(even) {
    background-color: var(--lighter);
}

/* Quiz Styles */
.quiz-container {
    background-color: var(--lighter);
    padding: 20px;
    border-radius: var(--border-radius-sm);
    margin-top: 25px;
    border: 1px solid var(--gray);
}

.quiz-question {
    font-weight: 600;
    margin-bottom: 15px;
    font-size: 1.1rem;
}

.quiz-options {
    margin-bottom: 15px;
    display: grid;
    gap: 10px;
}

.quiz-option {
    display: block;
    padding: 12px 15px;
    background-color: var(--white);
    border-radius: var(--border-radius-sm);
    cursor: pointer;
    transition: var(--transition);
    border: 1px solid var(--gray);
    font-size: 0.95rem;
}

.quiz-option:hover {
    background-color: var(--light);
    border-color: var(--primary-light);
}

.quiz-option.correct {
    background-color: var(--success);
    color: white;
    border-color: var(--success);
}

.quiz-option.incorrect {
    background-color: var(--error);
    color: white;
    border-color: var(--error);
}

.quiz-feedback {
    margin-top: 10px;
    padding: 12px;
    border-radius: var(--border-radius-sm);
    font-size: 0.9rem;
    display: none;
}

.quiz-feedback.correct {
    background-color: var(--success-light);
    color: var(--success);
    display: block;
    border-left: 4px solid var(--success);
}

.quiz-feedback.incorrect {
    background-color: var(--error-light);
    color: var(--error);
    display: block;
    border-left: 4px solid var(--error);
}

.quiz-actions {
    display: flex;
    justify-content: space-between;
    margin-top: 20px;
}

.quiz-btn {
    padding: 10px 20px;
    border-radius: var(--border-radius-sm);
    border: none;
    cursor: pointer;
    font-weight: 500;
    transition: var(--transition);
    font-size: 0.9rem;
}

.quiz-next {
    background-color: var(--primary);
    color: white;
    margin-left: auto;
}

.quiz-next:hover {
    background-color: var(--primary-dark);
}

.quiz-finish {
    background-color: var(--success);
    color: white;
    display: none;
}

.quiz-finish:hover {
    background-color: #27ae60;
}

.quiz-results {
    margin-top: 20px;
    padding: 15px;
    border-radius: var(--border-radius-sm);
    background-color: var(--light);
    display: none;
    text-align: center;
}

.quiz-final-result {
    font-weight: 500;
    font-size: 1.1rem;
}

/* Modal Colors */
.math-modal .learning-header {
    background-color: var(--math-color);
}
.math-modal .section-title {
    color: var(--math-color);
}
.math-modal .section-title::before {
    background-color: var(--math-color);
}

.portuguese-modal .learning-header {
    background-color: var(--portuguese-color);
}
.portuguese-modal .section-title {
    color: var(--portuguese-color);
}
.portuguese-modal .section-title::before {
    background-color: var(--portuguese-color);
}

.history-modal .learning-header {
    background-color: var(--history-color);
}
.history-modal .section-title {
    color: var(--history-color);
}
.history-modal .section-title::before {
    background-color: var(--history-color);
}

.school-history-modal .learning-header {
    background-color: var(--school-history-color);
}
.school-history-modal .section-title {
    color: var(--school-history-color);
}
.school-history-modal .section-title::before {
    background-color: var(--school-history-color);
}

.geography-modal .learning-header {
    background-color: var(--geography-color);
}
.geography-modal .section-title {
    color: var(--geography-color);
}
.geography-modal .section-title::before {
    background-color: var(--geography-color);
}

.biology-modal .learning-header {
    background-color: var(--biology-color);
}
.biology-modal .section-title {
    color: var(--biology-color);
}
.biology-modal .section-title::before {
    background-color: var(--biology-color);
}

.physics-modal .learning-header {
    background-color: var(--physics-color);
}
.physics-modal .section-title {
    color: var(--physics-color);
}
.physics-modal .section-title::before {
    background-color: var(--physics-color);
}

.chemistry-modal .learning-header {
    background-color: var(--chemistry-color);
}
.chemistry-modal .section-title {
    color: var(--chemistry-color);
}
.chemistry-modal .section-title::before {
    background-color: var(--chemistry-color);
}

.civics-modal .learning-header {
    background-color: var(--civics-color);
}
.civics-modal .section-title {
    color: var(--civics-color);
}
.civics-modal .section-title::before {
    background-color: var(--civics-color);
}

.english-modal .learning-header {
    background-color: var(--english-color);
}
.english-modal .section-title {
    color: var(--english-color);
}
.english-modal .section-title::before {
    background-color: var(--english-color);
}

/* Bottom Navigation */
.bottom-nav {
    position: fixed;
    bottom: 0;
    width: 100%;
    background-color: var(--white);
    box-shadow: 0 -1px 3px rgba(0, 0, 0, 0.1);
    display: flex;
    padding: 8px 0;
    z-index: 1000;
}

.nav-item {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: var(--text-light);
    text-decoration: none;
    font-size: 0.7rem;
    gap: 4px;
    transition: var(--transition);
    padding: 5px 0;
}

.nav-item.active {
    color: var(--primary);
}

.nav-item:hover {
    color: var(--primary);
}

.nav-icon {
    font-size: 1.2rem;
}

/* Responsive Design */
@media (min-width: 768px) {
    .main-content {
        padding: 90px 24px 24px;
    }

    .bottom-nav {
        display: none;
    }

    .learning-modules {
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    }

    .learning-container {
        max-width: 900px;
    }
}

@media (max-width: 480px) {
    .learning-modules {
        grid-template-columns: 1fr;
    }

    .module-card {
        max-width: 100%;
    }

    .quiz-options {
        grid-template-columns: 1fr;
    }
}

/* Utility Classes */
.text-center {
    text-align: center;
}

.mb-1 { margin-bottom: 0.5rem; }
.mb-2 { margin-bottom: 1rem; }
.mb-3 { margin-bottom: 1.5rem; }
.mb-4 { margin-bottom: 2rem; }

.hidden {
    display: none !important;
}
    </style>
</head>
<body>
    <!-- App Bar -->
    <header class="app-bar">
        <a href="home.html" class="logo">
            <i class="fas fa-graduation-cap logo-icon"></i>
            <span>Folha de Inhamissa</span>
        </a>
        <h1 class="app-bar-title">Aprenda</h1>
        <div class="app-bar-actions">
            <div class="search-btn" id="search-btn">
                <i class="fas fa-search"></i>
            </div>
            <div class="user-avatar" id="user-avatar" style="width: 40px; height: 40px; border-radius: 50%; background-color: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; cursor: pointer; margin-left: 10px;">
                <span id="avatar-initials">U</span>
            </div>
        </div>
    </header>

    <!-- Search Modal -->
    <div class="search-modal" id="search-modal">
        <div class="search-container">
            <div class="search-header">
                <i class="fas fa-search"></i>
                <input type="text" class="search-input" id="search-input" placeholder="Pesquisar...">
                <div class="close-search" id="close-search">&times;</div>
            </div>
            <div class="search-results" id="search-results">
                <div class="search-result-item">
                    <p>Funcionalidade de pesquisa em desenvolvimento</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="page-header">
            <h1 class="page-title">Aprenda Conosco</h1>
            <p class="page-subtitle">Conhecimento para todas as idades e n√≠veis</p>
        </div>

        <!-- Bot√£o para adicionar quiz -->
        <div style="text-align: center; margin-bottom: 30px;">
            <a href="submit-quiz.html" style="display: inline-block; padding: 14px 28px; background-color: var(--primary); color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: var(--transition); text-decoration: none;">
                <i class="fas fa-plus"></i> Adicionar Novo Quiz
            </a>
        </div>

        <!-- Quizzes da Comunidade -->
        <div id="community-quizzes" style="margin-bottom: 40px;"></div>

        <div class="learning-modules" id="quiz-grid">
            <!-- Quizzes da comunidade ser√£o carregados aqui -->
        </div>
    </main>

    

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="home.html" class="nav-item">
            <i class="fas fa-home nav-icon"></i>
            <span>In√≠cio</span>
        </a>
        <a href="aprenda.html" class="nav-item active">
            <i class="fas fa-book nav-icon"></i>
            <span>Aprenda</span>
        </a>
        <a href="horarios.html" class="nav-item">
            <i class="fas fa-calendar-alt nav-icon"></i>
            <span>Hor√°rios</span>
        </a>
        <a href="noticias.html" class="nav-item">
            <i class="fas fa-newspaper nav-icon"></i>
            <span>Not√≠cias</span>
        </a>
    </nav>

    <script type="module">
        // Import Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
        import { getFirestore, collection, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBJ8CVC2s_cb8nBdbrhPCbVbqqh6Cb9Vco",
            authDomain: "luna-bot-70962.firebaseapp.com",
            projectId: "luna-bot-70962",
            storageBucket: "luna-bot-70962.appspot.com",
            messagingSenderId: "247837414432",
            appId: "1:247837414432:web:f7f9df049b8cfdbd909845"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Carregar quizzes da comunidade
        async function loadCommunityQuizzes() {
            try {
                const quizzesQuery = query(collection(db, 'quizzes'), orderBy('createdAt', 'desc'), limit(20));
                const quizzesSnapshot = await getDocs(quizzesQuery);
                
                const container = document.getElementById('community-quizzes');
                
                if (!quizzesSnapshot.empty) {
                    container.innerHTML = '<h2 style="margin-bottom: 20px; color: var(--primary);">Quizzes da Comunidade</h2><div class="learning-modules" id="quiz-grid"></div>';
                    const quizGrid = document.getElementById('quiz-grid');
                    
                    quizzesSnapshot.forEach((doc) => {
                        const quiz = doc.data();
                        const quizCard = document.createElement('div');
                        quizCard.className = 'module-card';
                        quizCard.innerHTML = `
                            <div class="module-image" style="background: linear-gradient(135deg, var(--primary), var(--primary-dark)); position: relative;">
                                ${quiz.imageUrl ? `<img src="${quiz.imageUrl}" style="width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0;">` : `<i class="fas fa-question-circle"></i>`}
                            </div>
                            <div class="module-content">
                                <h3 class="module-title">${quiz.title}</h3>
                                <p class="module-description">${quiz.description}</p>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 12px; font-size: 0.85rem; color: var(--text-light);">
                                    <span><i class="fas fa-user"></i> ${quiz.authorName}</span>
                                    <span><i class="fas fa-calendar"></i> ${quiz.createdAt ? new Date(quiz.createdAt.toDate()).toLocaleDateString('pt-MZ') : 'Hoje'}</span>
                                </div>
                                <div style="margin-top: 8px; font-size: 0.85rem; color: var(--text-light);">
                                    <i class="fas fa-question"></i> ${quiz.questions.length} perguntas
                                </div>
                            </div>
                        `;
                        
                        quizCard.addEventListener('click', () => {
                            openQuizModal(quiz, doc.id);
                        });
                        
                        quizGrid.appendChild(quizCard);
                    });
                }
            } catch (error) {
                console.error('Erro ao carregar quizzes:', error);
            }
        }

        function openQuizModal(quiz, quizId) {
            const modal = document.createElement('div');
            modal.className = 'learning-modal';
            modal.style.display = 'block';
            
            let questionsHTML = '';
            quiz.questions.forEach((q, index) => {
                questionsHTML += `
                    <div class="quiz-question" style="${index === 0 ? '' : 'display:none'}">${index + 1}. ${q.question}</div>
                    <div class="quiz-options" style="${index === 0 ? '' : 'display:none'}">
                        ${q.options.map((opt, optIndex) => `
                            <div class="quiz-option" data-correct="${optIndex === q.correctIndex}">${opt}</div>
                        `).join('')}
                    </div>
                    <div class="quiz-feedback" style="display:none"></div>
                `;
            });
            
            modal.innerHTML = `
                <div class="learning-container">
                    <div class="learning-header" style="background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: #000;">
                        <h2 class="learning-title">${quiz.title}</h2>
                        <div class="close-learning" style="color: #000;">&times;</div>
                    </div>
                    <div class="learning-body">
                        <p style="margin-bottom: 20px;">${quiz.description}</p>
                        <div class="quiz-container">
                            ${questionsHTML}
                            <div class="quiz-actions">
                                <button class="quiz-next">Pr√≥xima</button>
                                <button class="quiz-finish" style="display:none">Finalizar</button>
                            </div>
                            <div class="quiz-results" style="display:none"></div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            modal.querySelector('.close-learning').addEventListener('click', () => {
                modal.remove();
            });
            
            window.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            initQuizzes();
        }

        loadCommunityQuizzes();
        
        // Carregar avatar do usu√°rio
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";
        import { getDoc, doc } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";
        
        const authAprenda = getAuth(app);
        
        onAuthStateChanged(authAprenda, async (user) => {
            if (user) {
                try {
                    const userDoc = await getDoc(doc(db, 'users', user.uid));
                    if (userDoc.exists()) {
                        const userData = userDoc.data();
                        const initials = userData.name ? 
                            userData.name.split(' ').map(n => n[0]).join('').toUpperCase() : 
                            user.email[0].toUpperCase();
                        
                        const userAvatar = document.getElementById('user-avatar');
                        const avatarInitials = document.getElementById('avatar-initials');
                        
                        if (userData.photoURL) {
                            userAvatar.innerHTML = `<img src="${userData.photoURL}" alt="Avatar" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
                        } else {
                            if (avatarInitials) {
                                avatarInitials.textContent = initials;
                            }
                        }
                    }
                } catch (error) {
                    console.error('Erro ao carregar usu√°rio:', error);
                }
            }
        });
    </script>
    <script>
// DOM Elements
const searchBtn = document.getElementById('search-btn');
const searchModal = document.getElementById('search-modal');
const closeSearchBtn = document.getElementById('close-search');
searchBtn.addEventListener('click', () => {
    searchModal.style.display = 'block';
});

closeSearchBtn.addEventListener('click', () => {
    searchModal.style.display = 'none';
});

window.addEventListener('click', (event) => {
    if (event.target === searchModal) searchModal.style.display = 'none';
});


// Improved Quiz functionality
function initQuizzes() {
    const quizzes = document.querySelectorAll('.quiz-container');

    quizzes.forEach(quiz => {
        const questions = quiz.querySelectorAll('.quiz-question');
        const nextBtn = quiz.querySelector('.quiz-next');
        const finishBtn = quiz.querySelector('.quiz-finish');
        const resultsDiv = quiz.querySelector('.quiz-results');
        let currentQuestion = 0;
        let score = 0;
        let answered = false;

        // Show first question
        showQuestion(currentQuestion);

        // Option click handler
        quiz.querySelectorAll('.quiz-option').forEach(option => {
            option.addEventListener('click', function() {
                if (answered) return;

                const isCorrect = this.getAttribute('data-correct') === 'true';
                const feedback = this.closest('.quiz-options').nextElementSibling;

                if (isCorrect) {
                    this.classList.add('correct');
                    feedback.textContent = 'Resposta correta!';
                    feedback.classList.add('correct');
                    score++;
                } else {
                    this.classList.add('incorrect');
                    feedback.textContent = 'Resposta incorreta.';
                    feedback.classList.add('incorrect');

                    // Show correct answer
                    const correctOption = this.parentElement.querySelector('[data-correct="true"]');
                    correctOption.classList.add('correct');
                }

                answered = true;
                nextBtn.style.display = 'inline-block';

                // Disable all options after answer
                const options = this.parentElement.querySelectorAll('.quiz-option');
                options.forEach(opt => {
                    opt.style.pointerEvents = 'none';
                });
            });
        });

        // Next question handler
        nextBtn.addEventListener('click', function() {
            currentQuestion++;
            answered = false;

            if (currentQuestion < questions.length) {
                showQuestion(currentQuestion);
                this.style.display = 'none';

                if (currentQuestion === questions.length - 1) {
                    finishBtn.style.display = 'inline-block';
                }
            }
        });

        // Finish quiz handler
        finishBtn.addEventListener('click', function() {
            const percentage = Math.round((score / questions.length) * 100);
            let message = '';

            if (percentage >= 80) {
                message = `Excelente! Voc√™ acertou ${score} de ${questions.length} perguntas (${percentage}%).`;
            } else if (percentage >= 60) {
                message = `Bom trabalho! Voc√™ acertou ${score} de ${questions.length} perguntas (${percentage}%).`;
            } else if (percentage >= 40) {
                message = `Voc√™ acertou ${score} de ${questions.length} perguntas (${percentage}%). Estude mais um pouco!`;
            } else {
                message = `Voc√™ acertou ${score} de ${questions.length} perguntas (${percentage}%). Recomendamos revisar o material.`;
            }

            resultsDiv.innerHTML = `<div class="quiz-final-result">${message}</div>`;
            resultsDiv.style.display = 'block';
            this.style.display = 'none';
            nextBtn.style.display = 'none';

            // Update progress in local storage
            updateProgress(quiz.id.replace('-quiz', ''), percentage);
        });

        function showQuestion(index) {
            // Hide all questions
            questions.forEach((q, i) => {
                q.style.display = 'none';
                q.nextElementSibling.style.display = 'none'; // options
                q.nextElementSibling.nextElementSibling.style.display = 'none'; // feedback
            });

            // Show current question
            questions[index].style.display = 'block';
            questions[index].nextElementSibling.style.display = 'block';

            // Enable options for current question
            const options = questions[index].nextElementSibling.querySelectorAll('.quiz-option');
            options.forEach(opt => {
                opt.style.pointerEvents = 'auto';
                opt.classList.remove('correct', 'incorrect');
            });

            // Show feedback for current question
            questions[index].nextElementSibling.nextElementSibling.style.display = 'block';
            questions[index].nextElementSibling.nextElementSibling.textContent = '';
            questions[index].nextElementSibling.nextElementSibling.classList.remove('correct', 'incorrect');
        }
    });
}

// Update user progress
function updateProgress(subject, percentage) {
    let progress = JSON.parse(localStorage.getItem('learningProgress')) || {};
    progress[subject] = percentage;
    localStorage.setItem('learningProgress', JSON.stringify(progress));

    // Update progress bar
    const progressBar = document.getElementById(`${subject}-progress`);
    if (progressBar) {
        progressBar.style.width = `${percentage}%`;
        progressBar.textContent = `${percentage}%`;
    }
}

// Initialize progress bars from local storage
function initProgressBars() {
    const progress = JSON.parse(localStorage.getItem('learningProgress')) || {};

    // Set progress for each subject
    const subjects = [
        'historia', 'matematica', 'portugues', 'historia-mocambique',
        'geografia', 'biologia', 'fisica', 'quimica', 'educacao-civica', 'ingles'
    ];

    subjects.forEach(subject => {
        const progressBar = document.getElementById(`${subject}-progress`);
        if (progressBar) {
            const percentage = progress[subject] || 0;
            progressBar.style.width = `${percentage}%`;
            progressBar.textContent = `${percentage}%`;
        }
    });
}

// Function to render dynamic quizzes
function renderDynamicQuizzes() {
    const container = document.getElementById('dynamic-quiz-container');
    if (!container) return;

    let html = '';
    
    dynamicQuizzes.forEach((quiz, quizIndex) => {
        html += `
            <div class="quiz-container" id="${quiz.id}-quiz" data-quiz-index="${quizIndex}">
                <h4 style="color: var(--primary); margin-bottom: 20px;">${quiz.title}</h4>
        `;

        quiz.questions.forEach((q, qIndex) => {
            const displayStyle = qIndex === 0 ? 'block' : 'none';
            html += `
                <div class="quiz-question" style="display:${displayStyle}">${qIndex + 1}. ${q.question}</div>
                <div class="quiz-options" style="display:${displayStyle}">
            `;

            q.options.forEach((option, optIndex) => {
                const isCorrect = optIndex === q.correctIndex;
                html += `<div class="quiz-option" data-correct="${isCorrect}">${option}</div>`;
            });

            html += `
                </div>
                <div class="quiz-feedback" style="display:${displayStyle}"></div>
            `;
        });

        html += `
                <div class="quiz-actions">
                    <button class="quiz-next">Pr√≥xima</button>
                    <button class="quiz-finish" style="display:none">Finalizar</button>
                </div>
                <div class="quiz-results" style="display:none"></div>
            </div>
        `;
    });

    container.innerHTML = html;
    initQuizzes();
}

// Function to add new quiz
function showAddQuizModal() {
    const modal = document.createElement('div');
    modal.className = 'learning-modal';
    modal.style.display = 'block';
    modal.innerHTML = `
        <div class="learning-container" style="max-width: 600px;">
            <div class="learning-header" style="background-color: var(--primary);">
                <h2 class="learning-title">Adicionar Novo Quiz</h2>
                <div class="close-learning" id="close-add-quiz">&times;</div>
            </div>
            <div class="learning-body">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">T√≠tulo do Quiz:</label>
                    <input type="text" id="quiz-title-input" style="width: 100%; padding: 12px; border: 1px solid var(--gray); border-radius: 8px; font-size: 1rem;" placeholder="Digite o t√≠tulo do quiz">
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Categoria:</label>
                    <select id="quiz-category-input" style="width: 100%; padding: 12px; border: 1px solid var(--gray); border-radius: 8px; font-size: 1rem;">
                        <option value="math">Matem√°tica</option>
                        <option value="portuguese">Portugu√™s</option>
                        <option value="history">Hist√≥ria</option>
                        <option value="geography">Geografia</option>
                        <option value="biology">Biologia</option>
                        <option value="physics">F√≠sica</option>
                        <option value="chemistry">Qu√≠mica</option>
                        <option value="civics">Educa√ß√£o C√≠vica</option>
                        <option value="english">Ingl√™s</option>
                        <option value="school-history">Hist√≥ria da Escola</option>
                    </select>
                </div>

                <div id="questions-container">
                    <h4 style="margin-bottom: 15px;">Perguntas:</h4>
                    <div class="question-item" data-question-index="0">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Pergunta 1:</label>
                        <input type="text" class="question-text" style="width: 100%; padding: 10px; border: 1px solid var(--gray); border-radius: 8px; margin-bottom: 10px;" placeholder="Digite a pergunta">
                        
                        <label style="display: block; margin-bottom: 8px;">Op√ß√µes (marque a correta):</label>
                        <div style="margin-bottom: 10px;">
                            <input type="radio" name="correct-0" value="0" checked>
                            <input type="text" class="option-text" style="width: 85%; padding: 8px; border: 1px solid var(--gray); border-radius: 8px; margin-left: 8px;" placeholder="Op√ß√£o 1">
                        </div>
                        <div style="margin-bottom: 10px;">
                            <input type="radio" name="correct-0" value="1">
                            <input type="text" class="option-text" style="width: 85%; padding: 8px; border: 1px solid var(--gray); border-radius: 8px; margin-left: 8px;" placeholder="Op√ß√£o 2">
                        </div>
                        <div style="margin-bottom: 10px;">
                            <input type="radio" name="correct-0" value="2">
                            <input type="text" class="option-text" style="width: 85%; padding: 8px; border: 1px solid var(--gray); border-radius: 8px; margin-left: 8px;" placeholder="Op√ß√£o 3">
                        </div>
                        <div style="margin-bottom: 20px;">
                            <input type="radio" name="correct-0" value="3">
                            <input type="text" class="option-text" style="width: 85%; padding: 8px; border: 1px solid var(--gray); border-radius: 8px; margin-left: 8px;" placeholder="Op√ß√£o 4">
                        </div>
                    </div>
                </div>

                <button id="add-question-btn" style="padding: 10px 20px; background-color: var(--info); color: white; border: none; border-radius: 8px; cursor: pointer; margin-bottom: 20px;">
                    <i class="fas fa-plus"></i> Adicionar Pergunta
                </button>

                <div style="text-align: center; margin-top: 20px;">
                    <button id="save-quiz-btn" style="padding: 14px 28px; background-color: var(--success); color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer;">
                        <i class="fas fa-save"></i> Salvar Quiz
                    </button>
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);

    let questionCount = 1;

    // Close modal
    document.getElementById('close-add-quiz').addEventListener('click', () => {
        modal.remove();
    });

    // Add question
    document.getElementById('add-question-btn').addEventListener('click', () => {
        const questionsContainer = document.getElementById('questions-container');
        const newQuestion = document.createElement('div');
        newQuestion.className = 'question-item';
        newQuestion.setAttribute('data-question-index', questionCount);
        newQuestion.innerHTML = `
            <hr style="margin: 20px 0; border: none; border-top: 1px solid var(--gray);">
            <label style="display: block; margin-bottom: 8px; font-weight: 600;">Pergunta ${questionCount + 1}:</label>
            <input type="text" class="question-text" style="width: 100%; padding: 10px; border: 1px solid var(--gray); border-radius: 8px; margin-bottom: 10px;" placeholder="Digite a pergunta">
            
            <label style="display: block; margin-bottom: 8px;">Op√ß√µes (marque a correta):</label>
            <div style="margin-bottom: 10px;">
                <input type="radio" name="correct-${questionCount}" value="0" checked>
                <input type="text" class="option-text" style="width: 85%; padding: 8px; border: 1px solid var(--gray); border-radius: 8px; margin-left: 8px;" placeholder="Op√ß√£o 1">
            </div>
            <div style="margin-bottom: 10px;">
                <input type="radio" name="correct-${questionCount}" value="1">
                <input type="text" class="option-text" style="width: 85%; padding: 8px; border: 1px solid var(--gray); border-radius: 8px; margin-left: 8px;" placeholder="Op√ß√£o 2">
            </div>
            <div style="margin-bottom: 10px;">
                <input type="radio" name="correct-${questionCount}" value="2">
                <input type="text" class="option-text" style="width: 85%; padding: 8px; border: 1px solid var(--gray); border-radius: 8px; margin-left: 8px;" placeholder="Op√ß√£o 3">
            </div>
            <div style="margin-bottom: 20px;">
                <input type="radio" name="correct-${questionCount}" value="3">
                <input type="text" class="option-text" style="width: 85%; padding: 8px; border: 1px solid var(--gray); border-radius: 8px; margin-left: 8px;" placeholder="Op√ß√£o 4">
            </div>
        `;
        questionsContainer.appendChild(newQuestion);
        questionCount++;
    });

    // Save quiz
    document.getElementById('save-quiz-btn').addEventListener('click', () => {
        const title = document.getElementById('quiz-title-input').value.trim();
        const category = document.getElementById('quiz-category-input').value;
        
        if (!title) {
            alert('Por favor, digite o t√≠tulo do quiz.');
            return;
        }

        const questionItems = document.querySelectorAll('.question-item');
        const questions = [];

        questionItems.forEach((item, index) => {
            const questionText = item.querySelector('.question-text').value.trim();
            const optionTexts = Array.from(item.querySelectorAll('.option-text')).map(input => input.value.trim());
            const correctIndex = parseInt(item.querySelector(`input[name="correct-${index}"]:checked`).value);

            if (!questionText || optionTexts.some(opt => !opt)) {
                return;
            }

            questions.push({
                question: questionText,
                options: optionTexts,
                correctIndex: correctIndex
            });
        });

        if (questions.length === 0) {
            alert('Por favor, adicione pelo menos uma pergunta completa.');
            return;
        }

        const newQuiz = {
            id: 'quiz-' + Date.now(),
            title: title,
            category: category,
            questions: questions
        };

        dynamicQuizzes.push(newQuiz);
        localStorage.setItem('customQuizzes', JSON.stringify(dynamicQuizzes));
        
        renderDynamicQuizzes();
        modal.remove();
        
        alert('Quiz adicionado com sucesso!');
    });

    // Close on outside click
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.remove();
        }
    });
}

// Load custom quizzes from localStorage
function loadCustomQuizzes() {
    const saved = localStorage.getItem('customQuizzes');
    if (saved) {
        try {
            const parsed = JSON.parse(saved);
            if (Array.isArray(parsed)) {
                dynamicQuizzes = parsed;
            }
        } catch (e) {
            console.error('Erro ao carregar quizzes:', e);
        }
    }
}

// Initialize when page loads
document.addEventListener('DOMContentLoaded', () => {
    initProgressBars();
    loadCustomQuizzes();
    renderDynamicQuizzes();
    
    const addQuizBtn = document.getElementById('add-quiz-btn');
    if (addQuizBtn) {
        addQuizBtn.addEventListener('click', showAddQuizModal);
    }
});
</script>
</body>
</html>